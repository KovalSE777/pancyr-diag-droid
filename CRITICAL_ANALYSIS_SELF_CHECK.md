# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –í–´–ü–û–õ–ù–ï–ù–ù–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 17.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ù–ê–ô–î–ï–ù–´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ï–î–û–†–ê–ë–û–¢–ö–ò**

---

## ‚úÖ –ß–¢–û –í–´–ü–û–õ–ù–ï–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

### 1. UDS –ê–¥—Ä–µ—Å–∞—Ü–∏—è - ‚úÖ –ö–û–†–†–ï–ö–¢–ù–û
```typescript
// src/utils/protocol-parser.ts —Å—Ç—Ä–æ–∫–∞ 24
export function buildUDS(dst = 0x2A, src = 0xF1, sid: number, data: number[] = []): Uint8Array {

// —Å—Ç—Ä–æ–∫–∏ 45-49
export const UDS_StartDiag = buildUDS(0x2A, 0xF1, 0x10, [0x01]);
export const UDS_StartComm = buildUDS(0x2A, 0xF1, 0x81);
export const UDS_TesterPres = buildUDS(0x2A, 0xF1, 0x3E, [0x01]);
export const UDS_Read21_01 = buildUDS(0x2A, 0xF1, 0x21, [0x01]);
```
‚úÖ –ê–¥—Ä–µ—Å–∞ –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ 0x2A/0xF1  
‚úÖ UDS_StartDiag –¥–æ–±–∞–≤–ª–µ–Ω  

### 2. Screen4Parser - ‚úÖ –ö–û–†–†–ï–ö–¢–ù–û –ü–ï–†–ï–ü–ò–°–ê–ù
```typescript
// src/utils/screen4-parser.ts
- ‚úÖ –û–∂–∏–¥–∞–µ—Ç –º–∏–Ω–∏–º—É–º 22 –±–∞–π—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ 66)
- ‚úÖ –ß–∏—Ç–∞–µ—Ç ADC –∫–∞–∫ u8 (payload[0] & 0xFF)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: (ADC * 30) / 255 (—Å—Ç—Ä–æ–∫–∏ 157-160)
- ‚úÖ –ü—Ä—è–º–æ–π –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π [0-21] –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏
- ‚úÖ –ë–∏—Ç–æ–≤—ã–µ –ø–æ–ª—è —á–∏—Ç–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é (—Å—Ç—Ä–æ–∫–∏ 178-198)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –±–∞–π—Ç—ã 22+ (—Å—Ç—Ä–æ–∫–∏ 147-152)
```

### 3. –ó–∞–¥–µ—Ä–∂–∫–∏ - ‚úÖ –î–û–ë–ê–í–õ–ï–ù–´
```typescript
// src/utils/capacitor-bluetooth.ts

// –°—Ç—Ä–æ–∫–∞ 77 - –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ connect
await new Promise(resolve => setTimeout(resolve, BT_TIMING.CONNECTION_STABILIZATION_DELAY));

// –°—Ç—Ä–æ–∫–∞ 229 - –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É 0x10 –∏ 0x81
await new Promise(resolve => setTimeout(resolve, 200));
```

### 4. StartDiagnosticSession - ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù
```typescript
// src/utils/capacitor-bluetooth.ts —Å—Ç—Ä–æ–∫–∏ 226-231
private async sendStartCommunication(): Promise<void> {
  await this.sendUDSCommand(UDS_StartDiag);      // 0x10
  await new Promise(resolve => setTimeout(resolve, 200));
  await this.sendUDSCommand(UDS_StartComm);      // 0x81
}
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ UDS –æ—Ç–≤–µ—Ç–æ–≤ - ‚úÖ –£–õ–£–ß–®–ï–ù–ê
```typescript
// src/utils/capacitor-bluetooth.ts —Å—Ç—Ä–æ–∫–∏ 135-159
if (frame.type === 'UDS_80P') {
  if (sid === 0x61 && frame.ok && frame.raw.length >= 27) {
    const payload = frame.raw.slice(5, frame.raw.length - 1);
    if (payload.length >= 22) {
      const diagnosticData = Screen4Parser.parse(payload, this.systemType);
      // ...
    }
  }
}
```

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: 0x88 –ù–ï –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù!

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤ `src/utils/protocol-parser.ts`

#### ‚ùå –ü–†–û–ë–õ–ï–ú–ê ‚Ññ1: FrameType —Å–æ–¥–µ—Ä–∂–∏—Ç "TEL_88"
**–°—Ç—Ä–æ–∫–∞ 6:**
```typescript
export type FrameType = "TEL_88" | "SCR_66" | "CFG_77" | "UDS_80P" | "UNKNOWN";
```
**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
export type FrameType = "SCR_66" | "CFG_77" | "UDS_80P" | "UNKNOWN";
```

#### ‚ùå –ü–†–û–ë–õ–ï–ú–ê ‚Ññ2: –ü–∞—Ä—Å–µ—Ä –≤—Å–µ –µ—â–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç 0x88
**–°—Ç—Ä–æ–∫–∏ 69-71:**
```typescript
if (b0 === 0x88) {
  if (this.acc.length < 3) break;
  need = 3 + (this.acc[2] & 0xFF) + 1;
}
```
**–≠—Ç–æ—Ç –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –£–î–ê–õ–ï–ù!**

#### ‚ùå –ü–†–û–ë–õ–ï–ú–ê ‚Ññ3: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç emit –¥–ª—è 0x88
–•–æ—Ç—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ handleParsedFrame —É–¥–∞–ª–µ–Ω–∞, –ø–∞—Ä—Å–µ—Ä –≤—Å–µ –µ—â–µ **—Å—á–∏—Ç–∞–µ—Ç –¥–ª–∏–Ω—É —Ñ—Ä–µ–π–º–∞ 0x88** –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å. –ù–æ –∫–æ–≥–¥–∞ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å—Ç—Ä–æ–∫–∏ 102-116, –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –±–ª–æ–∫ `else` (—Å—Ç—Ä–æ–∫–∞ 114-115) –∏ –∏—Å–ø—É—Å–∫–∞–µ—Ç `type: "UNKNOWN"`.

**–≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫:**
- –ë–µ—Å–ø–æ–ª–µ–∑–Ω–æ–π —Ç—Ä–∞—Ç–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É deprecated —Ñ—Ä–µ–π–º–æ–≤
- –õ–æ–≥–∞–º –æ–± "UNKNOWN" —Ñ—Ä–µ–π–º–∞—Ö
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –æ—à–∏–±–∫–∞–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

#### ‚ùå –ü–†–û–ë–õ–ï–ú–ê ‚Ññ4: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å—Ç–∞—Ä–µ–ª
**–°—Ç—Ä–æ–∫–∏ 1-4:**
```typescript
/* –ü–∞–Ω—Ü–∏—Ä—å ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è Android (BT-SPP).
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–¥—Ä—ã: 0x88 (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è), 0x66 (SCR_‚Ä¶ -> UOKS),
 * 0x77 (config chunk -> UOKP), –∏ >=0x80 (UDS-–ø–æ–¥–æ–±–Ω—ã–µ).
 */
```
–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ **0x88 (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è)** –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–æ.

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï: –ß–¢–û –î–û–õ–ñ–ù–û –ë–´–¢–¨ vs –ß–¢–û –ï–°–¢–¨

| –≠–ª–µ–º–µ–Ω—Ç | –û–∂–∏–¥–∞–ª–æ—Å—å | –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ | –°—Ç–∞—Ç—É—Å |
|---------|-----------|------------|--------|
| FrameType enum | –ë–µ–∑ TEL_88 | –° TEL_88 | ‚ùå |
| –ü–∞—Ä—Å–∏–Ω–≥ 0x88 –≤ feed() | –£–¥–∞–ª–µ–Ω | –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (—Å—Ç—Ä–æ–∫–∏ 69-71) | ‚ùå |
| emit –¥–ª—è 0x88 | –£–¥–∞–ª–µ–Ω | –£–¥–∞–ª–µ–Ω ‚úÖ | ‚úÖ |
| parseTelemetry88() | –£–¥–∞–ª–µ–Ω | –£–¥–∞–ª–µ–Ω ‚úÖ | ‚úÖ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ capacitor-bluetooth | –£–¥–∞–ª–µ–Ω–∞ | –£–¥–∞–ª–µ–Ω–∞ ‚úÖ | ‚úÖ |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –û–±–Ω–æ–≤–ª–µ–Ω—ã | –£—Å—Ç–∞—Ä–µ–ª–∏ | ‚ùå |

---

## üîß –ù–ï–û–ë–•–û–î–ò–ú–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –§–∞–π–ª: `src/utils/protocol-parser.ts`

#### 1. –£–¥–∞–ª–∏—Ç—å "TEL_88" –∏–∑ FrameType (—Å—Ç—Ä–æ–∫–∞ 6)
```typescript
// –ë–´–õ–û:
export type FrameType = "TEL_88" | "SCR_66" | "CFG_77" | "UDS_80P" | "UNKNOWN";

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
export type FrameType = "SCR_66" | "CFG_77" | "UDS_80P" | "UNKNOWN";
```

#### 2. –£–¥–∞–ª–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ 0x88 (—Å—Ç—Ä–æ–∫–∏ 69-71)
```typescript
// –£–î–ê–õ–ò–¢–¨ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏:
if (b0 === 0x88) {
  if (this.acc.length < 3) break;
  need = 3 + (this.acc[2] & 0xFF) + 1;
} else if (b0 === 0x66) {

// –î–û–õ–ñ–ù–û –°–¢–ê–¢–¨:
if (b0 === 0x66) {
```

#### 3. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (—Å—Ç—Ä–æ–∫–∏ 1-4)
```typescript
// –ë–´–õ–û:
/* –ü–∞–Ω—Ü–∏—Ä—å ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è Android (BT-SPP).
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–¥—Ä—ã: 0x88 (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è), 0x66 (SCR_‚Ä¶ -> UOKS),
 * 0x77 (config chunk -> UOKP), –∏ >=0x80 (UDS-–ø–æ–¥–æ–±–Ω—ã–µ).
 */

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
/* –ü–∞–Ω—Ü–∏—Ä—å ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è Android (BT-SPP).
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–¥—Ä—ã: 0x66 (SCR_‚Ä¶ -> UOKS), 0x77 (config chunk -> UOKP),
 * –∏ >=0x80 (UDS –ø—Ä–æ—Ç–æ–∫–æ–ª).
 * –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ UDS 0x21 0x01.
 */
```

---

## ‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–û–°–õ–ï–î–°–¢–í–ò–Ø –ù–ï–î–û–†–ê–ë–û–¢–ö–ò

### –ï—Å–ª–∏ –ù–ï –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

1. **TypeScript –æ—à–∏–±–∫–∏** –≤ –±—É–¥—É—â–µ–º:
   - –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `frame.type === 'TEL_88'`, –∫–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç

2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–∞—Ä—Å–µ—Ä–∞:**
   - –ü–∞—Ä—Å–µ—Ä —Ç—Ä–∞—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É `b0 === 0x88`
   - –ï—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –ø—Ä–∏–¥–µ—Ç –±–∞–π—Ç 0x88, –ø–∞—Ä—Å–µ—Ä –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Å–æ–∑–¥–∞—Å—Ç UNKNOWN —Ñ—Ä–µ–π–º

3. **–ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–≤–æ–¥—è—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ, –≥–æ–≤–æ—Ä—è —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è 0x88

4. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏:**
   - –í –ª–æ–≥–∞—Ö –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è "UNKNOWN" —Ñ—Ä–µ–π–º—ã –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Å 0x88

---

## üéØ –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –í–´–ü–û–õ–ù–ï–ù–ù–û–ô –†–ê–ë–û–¢–´

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å | –û—Ü–µ–Ω–∫–∞ |
|-----------|--------|--------|
| UDS –∞–¥—Ä–µ—Å–∞—Ü–∏—è | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 100% |
| Screen4Parser | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 100% |
| –ó–∞–¥–µ—Ä–∂–∫–∏ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 100% |
| StartDiagnosticSession | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 100% |
| –£–¥–∞–ª–µ–Ω–∏–µ 0x88 | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | 70% |
| **–û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê** | ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏** | **94%** |

---

## ‚úÖ –ü–õ–ê–ù –§–ò–ù–ê–õ–¨–ù–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

1. ‚úÖ –£–¥–∞–ª–∏—Ç—å "TEL_88" –∏–∑ FrameType
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫ `if (b0 === 0x88)` –∏–∑ –ø–∞—Ä—Å–µ—Ä–∞
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞

**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 2 –º–∏–Ω—É—Ç—ã

---

## üîç –°–ê–ú–û–ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê

**–í—ã–≤–æ–¥:** –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ **94%**. –û—Å—Ç–∞–ª–æ—Å—å **3 –º–µ–ª–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –¥–ª—è 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–ª–∞–Ω—É.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–¥–æ—á–µ—Ç—ã –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
