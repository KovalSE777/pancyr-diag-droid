# üîç –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –í–°–ï–• –ò–ó–ú–ï–ù–ï–ù–ò–ô - –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

**–î–∞—Ç–∞:** 17.10.2025  
**–ò—Ç–µ—Ä–∞—Ü–∏—è:** 3 (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≥–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

---

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó: PROTOCOL-PARSER.TS

### –ü—Ä–æ–≤–µ—Ä–∫–∞ buildUDS()
```typescript
// –°—Ç—Ä–æ–∫–∞ 25
export function buildUDS(dst = 0x2A, src = 0xF1, sid: number, data: number[] = []): Uint8Array {
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** –ê–¥—Ä–µ—Å–∞ 0x2A/0xF1 —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó v1.0

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç UDS –∫–æ–º–∞–Ω–¥
```typescript
// –°—Ç—Ä–æ–∫–∏ 47-50
export const UDS_StartDiag = buildUDS(0x2A, 0xF1, 0x10, [0x01]);
export const UDS_StartComm = buildUDS(0x2A, 0xF1, 0x81);
export const UDS_TesterPres = buildUDS(0x2A, 0xF1, 0x3E, [0x01]);
export const UDS_Read21_01 = buildUDS(0x2A, 0xF1, 0x21, [0x01]);
```
‚úÖ **–í–°–ï –ö–û–†–†–ï–ö–¢–ù–û:**
- StartDiagnosticSession (0x10) –¥–æ–±–∞–≤–ª–µ–Ω
- –í—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ 0x2A/0xF1

### –ü—Ä–æ–≤–µ—Ä–∫–∞ FrameType
```typescript
// –°—Ç—Ä–æ–∫–∞ 7
export type FrameType = "SCR_66" | "CFG_77" | "UDS_80P" | "UNKNOWN";
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** "TEL_88" —É–¥–∞–ª–µ–Ω

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ feed()
```typescript
// –°—Ç—Ä–æ–∫–∏ 70-73 (–±—ã–ª–æ 69-72)
if (b0 === 0x66) {
  if (this.acc.length < 6) break;
  need = 6;
} else if (b0 === 0x77) {
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** –ë–ª–æ–∫ `if (b0 === 0x88)` –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

### –ü—Ä–æ–≤–µ—Ä–∫–∞ emit()
```typescript
// –°—Ç—Ä–æ–∫–∏ 100-114
if (frame[0] === 0x66) {
  const n = frame[5] & 0xFF;
  emit({ type: "SCR_66", raw: frame, ok: true, info: { nScr: n } });
} else if (frame[0] === 0x77) {
  const nPak = frame[1] & 0xFF;
  const nBytes = (frame[2] & 0xFF) - 1;
  emit({ type: "CFG_77", raw: frame, ok, info: { nPak, nBytes } });
} else if (frame[0] >= 0x80) {
  const dst = frame[1] & 0xFF;
  const src = frame[2] & 0xFF;
  const sid = frame[3] & 0xFF;
  emit({ type: "UDS_80P", raw: frame, ok, info: { dst, src, sid } });
}
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ 0x88, —Ç–æ–ª—å–∫–æ UDS_80P

---

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó: SCREEN4-PARSER.TS

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ payload
```typescript
// –°—Ç—Ä–æ–∫–∏ 65-69
if (payload.length < 22) {
  logService.error('Screen4Parser', `Payload too short: ${payload.length} bytes, expected minimum 22`);
  return null;
}
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** –û–∂–∏–¥–∞–µ—Ç –º–∏–Ω–∏–º—É–º 22 –±–∞–π—Ç–∞ (–Ω–µ 33)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–µ–Ω–∏—è ADC –∫–∞–∫ u8

**–°–æ–≥–ª–∞—Å–Ω–æ –¢–ó v1.0 (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 2-3):**
```
Data[0] ‚Üí U_U_UM1 (ADC 0-255)
Data[1] ‚Üí U_U_UM2 (ADC)
Data[2] ‚Üí U_U_UM3 (ADC)
Data[3] ‚Üí U_U_FU (ADC)
...
Data[21] ‚Üí t_v_razg_cnd
```

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 73-137):**
```typescript
const U_U_UM1 = payload[0] & 0xFF;     // ‚úÖ Data[0]
const U_U_UM2 = payload[1] & 0xFF;     // ‚úÖ Data[1]
const U_U_UM3 = payload[2] & 0xFF;     // ‚úÖ Data[2]
const U_U_FU = payload[3] & 0xFF;      // ‚úÖ Data[3]
const uUPR_BT = payload[4] & 0xFF;     // ‚úÖ Data[4]
const uUPR_IND = payload[5] & 0xFF;    // ‚úÖ Data[5]
const sDAT_BIT = payload[6] & 0xFF;    // ‚úÖ Data[6]
const work_rej_cmp = payload[7] & 0xFF; // ‚úÖ Data[7]
const vdlt_cnd_i = payload[8] & 0xFF;  // ‚úÖ Data[8]
const vdlt_isp_i = payload[9] & 0xFF;  // ‚úÖ Data[9]
const vdlt_cmp_i = payload[10] & 0xFF; // ‚úÖ Data[10]
const timer_off = payload[11] & 0xFF;  // ‚úÖ Data[11]
const rej_cnd = payload[12] & 0xFF;    // ‚úÖ Data[12]
const rej_isp = payload[13] & 0xFF;    // ‚úÖ Data[13]
const edlt_cnd = payload[14] & 0xFF;   // ‚úÖ Data[14]
const edlt_isp = payload[15] & 0xFF;   // ‚úÖ Data[15]
const edlt_cmp = payload[16] & 0xFF;   // ‚úÖ Data[16]
const n_V_cnd = payload[17] & 0xFF;    // ‚úÖ Data[17]
const PWM_spd = payload[18] & 0xFF;    // ‚úÖ Data[18]
const s1_TMR2 = payload[19] & 0xFF;    // ‚úÖ Data[19]
const s0_TMR2 = payload[20] & 0xFF;    // ‚úÖ Data[20]
const t_v_razg_cnd = payload[21] & 0xFF; // ‚úÖ Data[21]
```
‚úÖ **100% –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¢–ó** - –≤—Å–µ 22 –ø–æ–ª—è —á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ u8 —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤!

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—É–ª—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è

**–°–æ–≥–ª–∞—Å–Ω–æ –¢–ó v1.0 (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 5, —Å—Ç—Ä–æ–∫–∞ 145):**
```
voltage ‚âà ADC*30/255
```

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 157-165):**
```typescript
const UP_M1 = (U_U_UM1 * 30) / 255;  // ‚úÖ
const UP_M2 = (U_U_UM2 * 30) / 255;  // ‚úÖ
const UP_M3 = (U_U_UM3 * 30) / 255;  // ‚úÖ
const U_nap = (U_U_FU * 30) / 255;   // ‚úÖ

const dUP_M1 = (vdlt_cnd_i * 30) / 255;  // ‚úÖ
const dUP_M2 = (vdlt_isp_i * 30) / 255;  // ‚úÖ
const dUP_M3 = (vdlt_cmp_i * 30) / 255;  // ‚úÖ
```
‚úÖ **–§–û–†–ú–£–õ–ê –¢–û–ß–ù–ê–Ø**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π

**–°–æ–≥–ª–∞—Å–Ω–æ –¢–ó v1.0 (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 4):**

**uUPR_BT (Data[4]):**
```
bit 0 ‚Üí uUP_M1  (–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞ 1)
bit 1 ‚Üí uUP_M2  (–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞ 2)
bit 2 ‚Üí uUP_M3  (–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞ 3 –°–ö–ê)
bit 3 ‚Üí uUP_M4  (–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∏—Å–ø–∞—Ä–∏—Ç–µ–ª—è 1)
bit 4 ‚Üí uUP_M5  (–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∏—Å–ø–∞—Ä–∏—Ç–µ–ª—è 2)
bit 5 ‚Üí uUP_CMP (–∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä)
```

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 178-183):**
```typescript
const uUP_M1 = !!(uUPR_BT & 0x01);   // bit 0 ‚úÖ
const uUP_M2 = !!(uUPR_BT & 0x02);   // bit 1 ‚úÖ
const uUP_M3 = !!(uUPR_BT & 0x04);   // bit 2 ‚úÖ
const uUP_M4 = !!(uUPR_BT & 0x08);   // bit 3 ‚úÖ
const uUP_M5 = !!(uUPR_BT & 0x10);   // bit 4 ‚úÖ
const uUP_CMP = !!(uUPR_BT & 0x20);  // bit 5 ‚úÖ
```
‚úÖ **–ü–û–õ–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï**

**uUPR_IND (Data[5]) - –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏:**
```typescript
const fuseEtalon = !!(uUPR_IND & 0x01);     // bit 0 ‚úÖ
const fuseCondenser = !!(uUPR_IND & 0x02);  // bit 1 ‚úÖ
const fuseEvaporator = !!(uUPR_IND & 0x04); // bit 2 ‚úÖ
const fuseCompressor = !!(uUPR_IND & 0x08); // bit 3 ‚úÖ
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û**

**sDAT_BIT (Data[6]) - —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```typescript
const bD_DAVL = !!(sDAT_BIT & 0x01);     // bit 0 - –¥–∞—Ç—á–∏–∫ –¥–∞–≤–ª–µ–Ω–∏—è ‚úÖ
const bVKL_CMP = !!(sDAT_BIT & 0x02);    // bit 1 - –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä –≤–∫–ª—é—á–µ–Ω ‚úÖ
const bBL_2 = !!(sDAT_BIT & 0x04);       // bit 2 - —Ç–∏–ø —Å–∏—Å—Ç–µ–º—ã ‚úÖ
const bK_NORM = !!(sDAT_BIT & 0x08);     // bit 3 - –∫–æ–Ω—Ç–∞–∫—Ç–æ—Ä –Ω–æ—Ä–º–∞ ‚úÖ
const bFTD_NORM = !!(sDAT_BIT & 0x10);   // bit 4 - –§–¢–î –Ω–æ—Ä–º–∞ ‚úÖ
const bBL2_1vnt = !!(sDAT_BIT & 0x20);   // bit 5 - –æ–¥–∏–Ω –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä ‚úÖ
const bNO_V_CMP = !!(sDAT_BIT & 0x40);   // bit 6 - –Ω–µ—Ç –≤—Ä–∞—â–µ–Ω–∏—è –ö–ú–ü ‚úÖ
```
‚úÖ **–ü–û–õ–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¢–ó**

---

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó: CAPACITOR-BLUETOOTH.TS

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
```typescript
// –°—Ç—Ä–æ–∫–∞ 2
import { ProtocolParser, ParsedFrame, UDS_StartDiag, UDS_StartComm, UDS_TesterPres, UDS_Read21_01, ackUOKS, ackUOKP } from './protocol-parser';
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** UDS_StartDiag –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```typescript
// –°—Ç—Ä–æ–∫–∏ 73-80
await this.bt.connect(mac);
logService.success('BT Serial', 'Socket connected');

// –ü–∞—É–∑–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
await new Promise(resolve => setTimeout(resolve, BT_TIMING.CONNECTION_STABILIZATION_DELAY));

// –¢–æ–ª—å–∫–æ –ü–û–°–õ–ï –ø–∞—É–∑—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –∫–æ–º–∞–Ω–¥—É
await this.sendStartCommunication();
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** –ü–∞—É–∑–∞ 200ms –ø–æ—Å–ª–µ connect (—Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1, —Å—Ç—Ä–æ–∫–∞ 16)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ sendStartCommunication()
```typescript
// –°—Ç—Ä–æ–∫–∏ 226-231
private async sendStartCommunication(): Promise<void> {
  // –°–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–∞–º –æ–±–º–µ–Ω–∞: —Å–Ω–∞—á–∞–ª–∞ StartDiagnosticSession, –∑–∞—Ç–µ–º StartCommunication
  await this.sendUDSCommand(UDS_StartDiag);
  await new Promise(resolve => setTimeout(resolve, 200)); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏
  await this.sendUDSCommand(UDS_StartComm);
}
```
‚úÖ **–ö–û–†–†–ï–ö–¢–ù–û:** 
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 0x10 StartDiagnosticSession
- –ü–∞—É–∑–∞ 200ms
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 0x81 StartCommunication

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ UDS –æ—Ç–≤–µ—Ç–∞

**–ö—Ä–∏—Ç–∏—á–Ω—ã–π –º–æ–º–µ–Ω—Ç - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ payload:**

```typescript
// –°—Ç—Ä–æ–∫–∏ 143-145
if (sid === 0x61 && frame.ok && frame.raw.length >= 27) {
  // –ò–∑–≤–ª–µ–∫–∞–µ–º payload (–ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞: HDR[1] + DST[1] + SRC[1] + SID[1] + LocalID[1] = 5 –±–∞–π—Ç)
  const payload = frame.raw.slice(5, frame.raw.length - 1);
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã UDS –æ—Ç–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1):**
```
[0] 0x80 + (–¥–ª–∏–Ω–∞)  ‚Üê HDR
[1] 0xF1            ‚Üê DST (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
[2] 0x2A            ‚Üê SRC (–ë–°–ö–£)
[3] 0x61            ‚Üê –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ 0x21
[4] 0x01            ‚Üê LocalIdentifier
[5] Data[0]         ‚Üê –Ω–∞—á–∞–ª–æ payload
...
[26] Data[21]       ‚Üê –∫–æ–Ω–µ—Ü 22-–±–∞–π—Ç–æ–≤–æ–≥–æ payload
[27] CHK            ‚Üê checksum
```

**–ü–æ–ª–Ω—ã–π –∫–∞–¥—Ä:**
- –ú–∏–Ω–∏–º—É–º: 1 (HDR) + 1 (DST) + 1 (SRC) + 1 (SID) + 1 (LocalID) + 22 (payload) + 1 (CHK) = **28 –±–∞–π—Ç**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏:**
```typescript
frame.raw.length >= 27  // ‚ùì –ü–†–û–í–ï–†–ò–¢–¨!
```

‚ö†Ô∏è **–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `>= 27` –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –∫–∞–¥—Ä –¥–ª–∏–Ω–æ–π 28 –±–∞–π—Ç, –µ—Å–ª–∏ —ç—Ç–æ –æ–ø–µ—á–∞—Ç–∫–∞!

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å—á–∏—Ç–∞–µ–º:
- frame.raw.length >= 27 –æ–∑–Ω–∞—á–∞–µ—Ç –º–∏–Ω–∏–º—É–º 27 –±–∞–π—Ç
- –ü–æ–ª–Ω—ã–π –∫–∞–¥—Ä = 28 –±–∞–π—Ç (5 –∑–∞–≥–æ–ª–æ–≤–æ–∫ + 22 payload + 1 CHK)
- 27 –±–∞–π—Ç = –Ω–µ–ø–æ–ª–Ω—ã–π –∫–∞–¥—Ä (–Ω–∞ 1 –±–∞–π—Ç –º–µ–Ω—å—à–µ)

‚ùå **–û–®–ò–ë–ö–ê –ù–ê–ô–î–ï–ù–ê!** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `>= 28`, –∞ –Ω–µ `>= 27`!

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è payload:**
```typescript
const payload = frame.raw.slice(5, frame.raw.length - 1);
```
- `frame.raw.slice(5, ...)` - –Ω–∞—á–∏–Ω–∞–µ–º —Å –∏–Ω–¥–µ–∫—Å–∞ 5 (Data[0]) ‚úÖ
- `frame.raw.length - 1` - –æ—Ç—Ä–µ–∑–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–π—Ç (CHK) ‚úÖ

–ï—Å–ª–∏ frame.raw.length = 28:
- payload = frame.raw.slice(5, 27)
- payload.length = 27 - 5 = 22 –±–∞–π—Ç–∞ ‚úÖ

‚úÖ **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ payload –ö–û–†–†–ï–ö–¢–ù–û** –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —á—Ç–æ –¥–ª–∏–Ω–∞ –∫–∞–¥—Ä–∞ >= 28

---

## ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ê –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### bluetooth-constants.ts - –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

**–§–∞–π–ª:** `src/utils/bluetooth-constants.ts`

**–°—Ç—Ä–æ–∫–∏ 24-29:**
```typescript
export const UDS_ADDRESSES = {
  BSKU: 0x28,      // ‚ùå –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0x2A
  TESTER: 0xF0,    // ‚ùå –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0xF1
  EXPECTED_DST: 0xF1,  // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  EXPECTED_SRC: 0x28,  // ‚ùå –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0x2A
} as const;
```

**–°—Ç–∞—Ç—É—Å:** 
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã **–ù–ï –ò–°–ü–û–õ–¨–ó–£–Æ–¢–°–Ø** –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ search)
- ‚ö†Ô∏è –ù–æ –ª—É—á—à–µ **–û–ë–ù–û–í–ò–¢–¨** –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—É—Ç–∞–Ω–∏—Ü—ã –≤ –±—É–¥—É—â–µ–º

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´, –¢–†–ï–ë–£–Æ–©–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã UDS –∫–∞–¥—Ä–∞

**–§–∞–π–ª:** `src/utils/capacitor-bluetooth.ts`  
**–°—Ç—Ä–æ–∫–∞:** 143

**–ë–´–õ–û:**
```typescript
if (sid === 0x61 && frame.ok && frame.raw.length >= 27) {
```

**–î–û–õ–ñ–ù–û –ë–´–¢–¨:**
```typescript
if (sid === 0x61 && frame.ok && frame.raw.length >= 28) {
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ–ª–Ω—ã–π –∫–∞–¥—Ä = 5 (–∑–∞–≥–æ–ª–æ–≤–æ–∫) + 22 (payload) + 1 (CHK) = **28 –±–∞–π—Ç**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `>= 27` –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–µ –∫–∞–¥—Ä—ã –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ

### 2. –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã UDS –∞–¥—Ä–µ—Å–æ–≤

**–§–∞–π–ª:** `src/utils/bluetooth-constants.ts`  
**–°—Ç—Ä–æ–∫–∏:** 24-29

**–î–û–õ–ñ–ù–û –ë–´–¢–¨:**
```typescript
export const UDS_ADDRESSES = {
  BSKU: 0x2A,          // –ê–¥—Ä–µ—Å –ë–°–ö–£ (—Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó v1.0)
  TESTER: 0xF1,        // –ê–¥—Ä–µ—Å —Ç–µ—Å—Ç–µ—Ä–∞
  EXPECTED_DST: 0xF1,  // –û–∂–∏–¥–∞–µ–º—ã–π –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö
  EXPECTED_SRC: 0x2A,  // –û–∂–∏–¥–∞–µ–º—ã–π –∞–¥—Ä–µ—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
} as const;
```

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –¢–ó v1.0

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---------------|--------|-----------|
| **–ê–¥—Ä–µ—Å–∞—Ü–∏—è** |
| DST=0x2A, SRC=0xF1 –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö | ‚úÖ | protocol-parser.ts —Å—Ç—Ä–æ–∫–∞ 25 |
| DST=0xF1, SRC=0x2A –≤ –æ—Ç–≤–µ—Ç–∞—Ö | ‚úÖ | –ü–∞—Ä—Å–µ—Ä –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç |
| **Payload —Ñ–æ—Ä–º–∞—Ç** |
| 22 –±–∞–π—Ç–∞ –º–∏–Ω–∏–º—É–º | ‚úÖ | screen4-parser.ts —Å—Ç—Ä–æ–∫–∞ 66 |
| Data[0]=U_U_UM1 | ‚úÖ | payload[0] —Å—Ç—Ä–æ–∫–∞ 74 |
| Data[1]=U_U_UM2 | ‚úÖ | payload[1] —Å—Ç—Ä–æ–∫–∞ 77 |
| ... –≤—Å–µ 22 –ø–æ–ª—è | ‚úÖ | —Å—Ç—Ä–æ–∫–∏ 74-137 |
| **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** |
| voltage = ADC*30/255 | ‚úÖ | —Å—Ç—Ä–æ–∫–∏ 157-165 |
| ADC –∫–∞–∫ u8 (0-255) | ‚úÖ | `payload[i] & 0xFF` |
| **–ë–∏—Ç–æ–≤—ã–µ –ø–æ–ª—è** |
| uUPR_BT –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ | ‚úÖ | —Å—Ç—Ä–æ–∫–∏ 178-183 |
| uUPR_IND –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ | ‚úÖ | —Å—Ç—Ä–æ–∫–∏ 186-189 |
| sDAT_BIT –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ | ‚úÖ | —Å—Ç—Ä–æ–∫–∏ 192-198 |
| **–ü—Ä–æ—Ç–æ–∫–æ–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** |
| –ü–∞—É–∑–∞ 200ms –ø–æ—Å–ª–µ connect | ‚úÖ | capacitor-bluetooth.ts —Å—Ç—Ä–æ–∫–∞ 77 |
| StartDiagnosticSession (0x10) | ‚úÖ | —Å—Ç—Ä–æ–∫–∞ 228 |
| –ü–∞—É–∑–∞ –º–µ–∂–¥—É 0x10 –∏ 0x81 | ‚úÖ | —Å—Ç—Ä–æ–∫–∞ 229 |
| StartCommunication (0x81) | ‚úÖ | —Å—Ç—Ä–æ–∫–∞ 230 |
| **–°–ª—É–∂–µ–±–Ω—ã–µ –∫–∞–¥—Ä—ã** |
| UOKS –±–∞–π—Ç–æ–º (–Ω–µ —Å–∏–º–≤–æ–ª–æ–º) | ‚úÖ | protocol-parser.ts —Å—Ç—Ä–æ–∫–∞ 53 |
| UOKP –±–∞–π—Ç–æ–º (–Ω–µ —Å–∏–º–≤–æ–ª–æ–º) | ‚úÖ | protocol-parser.ts —Å—Ç—Ä–æ–∫–∞ 54 |
| **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ payload** |
| –ù–∞—á–∞–ª–æ —Å –±–∞–π—Ç–∞ [5] | ‚úÖ | capacitor-bluetooth.ts —Å—Ç—Ä–æ–∫–∞ 145 |
| –£–¥–∞–ª–µ–Ω–∏–µ CHK | ‚úÖ | slice(..., length-1) |
| **–ü–†–û–ë–õ–ï–ú–´** |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∫–∞–¥—Ä–∞ | ‚ùå | >= 27 –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 28 |
| –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã UDS_ADDRESSES | ‚ö†Ô∏è | –£—Å—Ç–∞—Ä–µ–ª–∏ (–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è) |

---

## üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¶–ï–ù–ö–ê

### –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: 98%
- ‚úÖ UDS –∞–¥—Ä–µ—Å–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –ü–∞—Ä—Å–µ—Ä 22-–±–∞–π—Ç–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –§–æ—Ä–º—É–ª—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç–æ—á–Ω—ã–µ
- ‚úÖ –ë–∏—Ç–æ–≤—ã–µ –ø–æ–ª—è —á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∫–∞–¥—Ä–∞ –∏–º–µ–µ—Ç –æ—à–∏–±–∫—É (< 27 –≤–º–µ—Å—Ç–æ >= 28)

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã >= 27** - üî¥ **–ö–†–ò–¢–ò–ß–ù–û** (–º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ –∫–∞–¥—Ä—ã)
2. **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã UDS_ADDRESSES** - üü° **–ù–ò–ó–ö–ê–Ø** (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –Ω–æ –ø—É—Ç–∞—é—Ç)

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–°–ü–†–ê–í–ò–¢–¨:**
   - –ò–∑–º–µ–Ω–∏—Ç—å `>= 27` –Ω–∞ `>= 28` –≤ capacitor-bluetooth.ts —Å—Ç—Ä–æ–∫–∞ 143

2. **–ñ–ï–õ–ê–¢–ï–õ–¨–ù–û –ò–°–ü–†–ê–í–ò–¢–¨:**
   - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã UDS_ADDRESSES –≤ bluetooth-constants.ts

3. **–ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:**
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–µ–º–∞/–æ—Ç–ø—Ä–∞–≤–∫–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ payload –ø–∞—Ä—Å–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–ö–æ–Ω–µ—Ü –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞**
